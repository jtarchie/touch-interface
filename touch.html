<html>
<head>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
	<script src="https://raw.github.com/DmitryBaranovskiy/raphael/master/raphael.js"></script>
	<script src="http://jashkenas.github.com/coffee-script/extras/coffee-script.js"></script>
</head>
<body>
  <script type="text/coffeescript">
    class TouchEventsDelegator
      constructor: (@owner) ->
        @touches = {}
        @owner.touchstart (event) => @operateTouch event, @start
        @owner.touchmove (event) => @operateTouch event, @move
        @owner.touchend (event) => @operateTouch event, @end
        @owner.touchcancel (event) => @operateTouch event, @end

      operateTouch: (event, func) ->
        event.preventDefault()
        func(touch) for touch in event.changedTouches

    class ApplicationTouchEvents extends TouchEventsDelegator
      start: (touch) ->
        @touches[touch.identifier] = @owner.circle(touch.pageX, touch.pageY, 10).attr('fill', '#ffffff')
      move: (touch) ->
        @touches[touch.identifier].animate(
          cx: touch.pageX,
          cy: touch.pageY
        , 10)
      end: (touch) ->
        @touches[touch.identifier].remove();
        delete touches[touch.identifier];
        
    class Application
      constructor: ->
        @document = $(document)
        @paper = Raphael(0, 0, @width(), @height())
        @canvas = @paper.rect(0, 0, @width(), @height()).attr(
          fill: '#000000'
        )

      run: ->
        @instructionPanel = new InstructionPanel(this)
        @programPanel = new ProgramPanel(this)
        @designPanel = new DesignPanel(this)
        @runPanel = new RunPanel(this)
        
        new ApplicationTouchEvents(@canvas)
          
      width: -> @document.width()
      height: -> @document.height()

    class Panel
      constructor: (@app) ->
        @draw()
        
    class InstructionPanel extends Panel
      @width: 50
      draw: ->
        @container = @app.paper.rect(0, 0, InstructionPanel.width, app.height()).attr(
          stroke: '#c0c0c0',
          fill: '#fff'
        )
    
    class ProgramPanel extends Panel
      draw: ->
        @container = @app.paper.rect(
          InstructionPanel.width, 0,
          app.width() / 2, app.height() / 2
        ).attr(
          'stroke': '#c0c0c0'
        )
        
    class DesignPanel extends Panel
      draw: ->
        @container = @app.paper.rect(
          app.width() / 2 + InstructionPanel.width, 0,
          app.width() / 2, app.height() / 2
        ).attr(
          'stroke': '#c0c0c0'
        )

    class RunPanel extends Panel
      draw: ->
        @container = @app.paper.rect(
          InstructionPanel.width, app.height() / 2,
          app.width() * 2, app.height() * 2
        ).attr(
          'stroke': '#c0c0c0'
        )
    app = new Application()
    $( -> app.run())
  </script>
</body>
</html>